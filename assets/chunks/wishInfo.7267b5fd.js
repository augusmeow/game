import{d as y,p as h,j,k as p,r as x,l as b}from"./utils.454c0124.js";import"./zh.e51bc494.js";y.locale("zh");const m=10;let A=y().year(2e3),l=y();const g=(e,i,s)=>{let n,a;e.start=e.start.replace(/-/g,"/"),e.end=e.end.replace(/-/g,"/"),n=h(e.start).subtract(0,"minute"),a=h(e.end).subtract(0,"minute");const f=a.diff(n,"day",!0);return A<a&&(A=a),{...e,index:i,index2:s,start:n,end:a,duration:f}},D=e=>{let i=[],s=[],n=[],a=[],f=[];f[0]=e.characters,f[1]=e.weapons;let c=f.map((t,r)=>Array.isArray(t)?t.map((o,u)=>g(o,r,u)):g(t,r,r));c.slice().sort((t,r)=>Array.isArray(t)&&Array.isArray(r)?t[0].start-r[0].start:!Array.isArray(t)&&Array.isArray(r)?t.start-r[0].start:Array.isArray(t)&&!Array.isArray(r)?t[0].start-r.start:t.start-r.start).forEach((t,r)=>{if(r===0&&(Array.isArray(t)?l=t[0].start.set("hour",0).set("minute",0).set("second",0).subtract(m,"day"):l=t.start.set("hour",0).set("minute",0).set("second",0).subtract(m,"day")),Array.isArray(t))for(let o=0;o<t.length;o++){const u=t[o];c[u.index][o].offset=Math.abs(l.diff(c[u.index][o].start,"day",!0))}else c[t.index].offset=Math.abs(l.diff(t.start,"day",!0))});const d=Math.abs(Math.ceil(l.diff(A,"day",!0)))+2*m;for(let t=0;t<d;t++){const r=l.add(t,"day").format("YYYY"),o=l.add(t,"day").format("MMMM");s[r]===void 0&&(s[r]=[]),s[r][o]===void 0&&(s[r][o]={total:0,offset:0}),s[r][o].total++}n=Object.entries(s);for(let t=0;t<n.length;t++){let r=Object.entries(n[t][1]);a=a.concat(r)}for(let t=0;t<a.length;t++)a[t][1].offset=t-1>=0?a[t-1][1].total+a[t-1][1].offset:0;return i=[...new Array(d)].map((t,r)=>{const o=l.add(r,"day");return[o.date(),o.format("dd")]}),{dates:i,years:s,yearList:n,monthList:a,events:c,firstDay:l}},B=e=>{let i={wishIndex:[],comingIndex:[]};for(let s of e){let n=y().isAfter(s.start,"second"),a=y().isBefore(s.end,"second");n&&a&&i.wishIndex.push(s.index2),y().isBefore(s.start,"second")&&i.comingIndex.push(s.index2)}return i},I=(e,i=0)=>{let s=b(i),n=[],a=[];for(let t=0;t<e.name.length;++t)n.push(`/image/${s}/wish/${j(e.name[t],e.image[t])}`),a.push(e.wish5star[t]);let f=p(e.start),c=p(e.end),d=e.wish4star;return Array.isArray(d)&&(d=d==null?void 0:d.map((t,r,o)=>x(t))),{name:e.wishName,date:f+" ~ "+c,ver:e.version,image:e.image,src:n,wish5star:a,wish4star:d}},E=(e,i,s=0)=>{let n={index:i,able:i.length>0,obj:[]};for(let a of i){const f=I(e[a],s);n.obj.push(f)}return n};export{E as a,B as g,D as p};
